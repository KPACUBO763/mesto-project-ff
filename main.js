(()=>{"use strict";var t=function(t){t.closest(".card").remove()},e=function(t){t.classList.toggle("card__like-button_is-active")},n=function(t,e,n,r,o,c,a,i){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__title"),s=u.querySelector(".card__image"),d=u.querySelector(".card__like-button"),f=u.querySelector(".card__like-counter"),p=u.querySelector(".card__delete-button");return s.addEventListener("click",o),l.textContent=t.name,s.src=t.link,s.alt=t.name,e!==t.owner._id?(p.style.display="none",p.disabled=!0):u.querySelector(".card__delete-button").addEventListener("click",(function(e){c(t._id).then((function(){return n(e)})).catch((function(t){return console.log("Ошибка: ",t)}))})),d.addEventListener("click",(function(e){e.target.classList.contains("card__like-button_is-active")?i(t._id).then((function(t){f.textContent=t.likes.length,r(e)})).catch((function(t){return console.log("Ошибка: ",t)})):a(t._id).then((function(t){f.textContent=t.likes.length,r(e)})).catch((function(t){return console.log("Ошибка: ",t)}))})),u};function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c),t.addEventListener("click",a),t.addEventListener("click",i)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),t.removeEventListener("click",a),t.removeEventListener("click",i)}function c(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}function a(t){t.target.classList.contains("popup__close")&&o(t.currentTarget)}function i(t){t.target.classList.contains("popup__content")||o(t.target)}var u=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},l=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){u(t,n,e)})),s(n,r,e)},s=function(t,e,n){d(t)?(e.setAttribute("disabled",!0),e.classList.add(n.inactiveButtonClass)):(e.removeAttribute("disabled",!1),e.classList.remove(n.inactiveButtonClass))},d=function(t){return t.some((function(t){return!t.validity.valid}))},f="https://nomoreparties.co/v1/wff-cohort-9",p={authorization:"76979254-0dab-487c-8237-afe4e26a9148","Content-Type":"application/json"},m=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},y=function(t,e){fetch("".concat(f,"/").concat(t),e.then(m))},v=function(t){return y("".concat(f,"/cards/").concat(t),{method:"DELETE",headers:p})},_=function(t){return y("".concat(f,"/cards/likes/").concat(t._id),{method:"PUT",headers:p})},h=function(t){return y("".concat(f,"/cards/likes/").concat(t._id),{method:"DELETE",headers:p})};function S(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var g=document.querySelector(".places__list"),C=document.querySelectorAll(".popup"),E=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),L=document.querySelector(".popup__button"),k=document.querySelector(".profile__edit-button"),x=document.querySelector(".popup_type_edit"),A=document.forms["edit-profile"],w=A.name,T=A.description,j=document.querySelector(".profile__title"),O=document.querySelector(".profile__description"),I=document.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_new-card"),D=document.forms["new-place"],P=document.querySelector(".popup_type_image"),M=P.querySelector(".popup__image"),N=P.querySelector(".popup__caption"),J=document.querySelector(".profile__image"),H=document.querySelector(".popup_type_edit-avatar"),U=document.forms["edit-avatar"],V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);s(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(t,e,n):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=e.validationMessage,r.classList.add(n.errorClass)}(t,e,n)}(t,o,e),s(n,r,e)}))}))}(e,t)}))}(V);var z,$,F=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=S(t))){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,c=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw c}}}}(C);try{for(F.s();!(z=F.n()).done;)z.value.classList.add("popup_is-animated")}catch(t){F.e(t)}finally{F.f()}Promise.all([y("".concat(f,"/users/me"),{headers:p}),fetch("".concat(f,"/cards"),{headers:p})]).then((function(r){var o,c,a,i=(a=2,function(t){if(Array.isArray(t))return t}(c=r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(c,a)||S(c,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],l=i[1];$=u._id,function(t){E.textContent=t.name,q.textContent=t.about,J.style.backgroundImage="url(".concat(t.avatar,")")}(u),o=l,u._id,o.forEach((function(r){g.append(n(r,$,t,e,G,v,_,h))}))})).catch((function(t){return console.log("Ошибка: ",t)})),A.addEventListener("submit",(function(t){var e,n;t.preventDefault(),L.textContent="Сохранение...",(e=w.value,n=T.value,y("".concat(f,"/users/me"),{method:"PATCH",headers:p,body:JSON.stringify({name:e,about:n})})).then((function(t){j.textContent=t.name,O.textContent=t.about,o(x)})).catch((function(t){return console.log("Ошибка: ",t)})).finaly((function(){return L.textContent="Сохранить"}))})),D.addEventListener("submit",(function(r){var c;r.preventDefault(),L.textContent="Сохранение...",r.target["place-name"].value,r.target.link.value,(c=data,y("".concat(f,"/cards"),{method:"POST",headers:p,body:JSON.stringify({name:c.name,link:c.link})})).then((function(c){g.prepend(n(c,$,t,e,G,v,_,h)),o(B),r.target.reset()})).catch((function(t){return console.log("Ошибка: ",t)})).finaly((function(){return L.textContent="Сохранить"}))})),U.addEventListener("submit",(function(t){var e;t.preventDefault(),L.textContent="Сохранение...",(e=U.elements["avatar-link"].value,y("".concat(f,"/users/me/avatar"),{method:"PATCH",headers:p,body:JSON.stringify({avatar:e})})).then((function(t){J.style.backgroundImage="url(".concat(t.avatar,")"),o(H)})).catch((function(t){return console.log("Ошибка: ",t)})).finaly((function(){return L.textContent="Сохранить"}))}));var G=function(t){M.alt=t.target.alt,M.src=t.target.src,N.textContent=t.target.alt,r(P)};J.addEventListener("click",(function(){l(U,V),r(H)})),k.addEventListener("click",(function(){w.value=E.textContent,T.value=q.textContent,l(x,V),r(x)})),I.addEventListener("click",(function(){l(B,V),r(B)}))})();