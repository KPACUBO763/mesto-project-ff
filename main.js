(()=>{"use strict";var t=function(t){t.closest(".card").remove()},e=function(t){t.classList.toggle("card__like-button_is-active")},n=function(t,e,n,r,o,c,a,i){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__title"),s=u.querySelector(".card__image"),d=u.querySelector(".card__like-button"),f=u.querySelector(".card__like-counter"),p=u.querySelector(".card__delete-button");return s.addEventListener("click",o),l.textContent=t.name,s.src=t.link,s.alt=t.name,e!==t.owner._id?(p.style.display="none",p.disabled=!0):u.querySelector(".card__delete-button").addEventListener("click",(function(e){c(t._id).then((function(){return n(e)})).catch((function(t){return console.log("Ошибка при удалении карточки: ",t)}))})),d.addEventListener("click",(function(e){e.target.classList.contains("card__like-button_is-active")?i(t._id).then((function(t){f.textContent=t.likes.length,r(e)})).catch((function(t){return console.log("Ошибка при удалении лайка: ",t)})):a(t._id).then((function(t){f.textContent=t.likes.length,r(e)})).catch((function(t){return console.log("Ошибка при добавлении лайка: ",t)}))})),u};function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c),t.addEventListener("click",a),t.addEventListener("click",i)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),t.removeEventListener("click",a),t.removeEventListener("click",i)}function c(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}function a(t){t.target.classList.contains("popup__close")&&o(t.currentTarget)}function i(t){t.target.classList.contains("popup__content")||o(t.target)}var u=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},l=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){u(t,n,e)})),s(n,r,e)},s=function(t,e,n){d(t)?(e.setAttribute("disabled",!0),e.classList.add(n.inactiveButtonClass)):(e.removeAttribute("disabled",!1),e.classList.remove(n.inactiveButtonClass))},d=function(t){return t.some((function(t){return!t.validity.valid}))},f={authorization:"76979254-0dab-487c-8237-afe4e26a9148","Content-Type":"application/json"},p=function(t){return t.ok?t.json():Promise.reject("Ошибка запроса: ".concat(t.status))},m=function(t,e){fetch("".concat("https://nomoreparties.co/v1/wff-cohort-9","/").concat(t),e).then(p)},y=function(t){return m("/cards/".concat(t),{method:"DELETE",headers:f})},v=function(t){return m("/cards/likes/".concat(t),{method:"PUT",headers:f})},_=function(t){return m("/cards/likes/".concat(t),{method:"DELETE",headers:f})};function h(t,e){if(t){if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var b=document.querySelector(".places__list"),g=document.querySelectorAll(".popup"),C=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),q=document.querySelector(".popup__button"),L=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),x=document.forms["edit-profile"],A=x.name,w=x.description,T=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),O=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_new-card"),B=document.forms["new-place"],D=document.querySelector(".popup_type_image"),P=D.querySelector(".popup__image"),M=D.querySelector(".popup__caption"),N=document.querySelector(".profile__image"),J=document.querySelector(".popup_type_edit-avatar"),H=document.forms["edit-avatar"],U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);s(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(t,e,n):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=e.validationMessage,r.classList.add(n.errorClass)}(t,e,n)}(t,o,e),s(n,r,e)}))}))}(e,t)}))}(U);var V,z,$=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h(t))){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,c=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw c}}}}(g);try{for($.s();!(V=$.n()).done;)V.value.classList.add("popup_is-animated")}catch(t){$.e(t)}finally{$.f()}Promise.all([m("/users/me",{headers:f}),m("/cards",{headers:f})]).then((function(r){var o,c,a,i=(a=2,function(t){if(Array.isArray(t))return t}(c=r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(c,a)||h(c,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],l=i[1];z=u._id,o=u,C.textContent=o.name,E.textContent=o.about,N.style.backgroundImage="url(".concat(o.avatar,")"),function(r){r.forEach((function(r){b.append(n(r,z,t,e,F,y,v,_))}))}(l)})).catch((function(t){return console.log("Ошибка: загрузки информации о пользователе и карточек",t)})),x.addEventListener("submit",(function(t){var e,n;t.preventDefault(),q.textContent="Сохранение...",(e=A.value,n=w.value,m("/users/me",{method:"PATCH",headers:f,body:JSON.stringify({name:e,about:n})})).then((function(t){T.textContent=t.name,j.textContent=t.about,o(k)})).catch((function(t){return console.log("Ошибка редактирования профиля: ",t)})).finaly((function(){return q.textContent="Сохранить"}))})),B.addEventListener("submit",(function(r){var c;r.preventDefault(),q.textContent="Сохранение...",(c={name:r.target["place-name"].value,link:r.target.link.value},m("/cards",{method:"POST",headers:f,body:JSON.stringify({name:c.name,link:c.link})})).then((function(c){b.prepend(n(c,z,t,e,F,y,v,_)),o(I),r.target.reset()})).catch((function(t){return console.log("Ошибка добавления новой карточки: ",t)})).finaly((function(){return q.textContent="Сохранить"}))})),H.addEventListener("submit",(function(t){var e;t.preventDefault(),q.textContent="Сохранение...",(e=t.target["avatar-link"].value,m("/users/me/avatar",{method:"PATCH",headers:f,body:JSON.stringify({avatar:e})})).then((function(e){N.style.backgroundImage="url(".concat(e.avatar,")"),o(J),t.target.reset()})).catch((function(t){return console.log("Ошибка изменения аватара: ",t)})).finaly((function(){return q.textContent="Сохранить"}))}));var F=function(t){P.alt=t.target.alt,P.src=t.target.src,M.textContent=t.target.alt,r(D)};N.addEventListener("click",(function(){l(H,U),r(J)})),L.addEventListener("click",(function(){A.value=C.textContent,w.value=E.textContent,l(k,U),r(k)})),O.addEventListener("click",(function(){l(I,U),r(I)}))})();